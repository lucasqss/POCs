-- USUARIOS --

-- Versao do oracle para drop if exists para users
BEGIN
    EXECUTE IMMEDIATE 'DROP USER SIGLA CASCADE';
    EXECUTE IMMEDIATE 'DROP USER MICROSSERVICO CASCADE';
EXCEPTION
    WHEN OTHERS THEN
        IF SQLCODE != -1918 THEN
            RAISE;
        END IF;
END;

CREATE USER SIGLA IDENTIFIED BY cenha;
ALTER USER SIGLA QUOTA UNLIMITED ON USERS;


CREATE USER MICROSSERVICO IDENTIFIED BY cenha;

--  Dando grants de conexao para o usuario
GRANT CREATE SESSION TO MICROSSERVICO;
GRANT CONNECT TO MICROSSERVICO;


-- ROLES --

-- Versao do oracle para drop if exists para roles
BEGIN
    EXECUTE IMMEDIATE 'DROP ROLE consultar';
    EXECUTE IMMEDIATE 'DROP ROLE atualizar';
    EXECUTE IMMEDIATE 'DROP ROLE deletar';
    EXECUTE IMMEDIATE 'DROP ROLE inserir';
EXCEPTION
    WHEN OTHERS THEN
        IF SQLCODE != -1919 THEN
            RAISE;
        END IF;
END;


CREATE ROLE consultar;
CREATE ROLE atualizar;
CREATE ROLE deletar;
CREATE ROLE inserir;


-- CONFIGS SCHEMA --

ALTER SESSION SET CURRENT_SCHEMA = SIGLA;

grant select any table to consultar;
grant update any table to atualizar;
grant delete any table to deletar;
grant insert any table to inserir;

GRANT consultar TO MICROSSERVICO;
GRANT atualizar TO MICROSSERVICO;
GRANT deletar TO MICROSSERVICO;
GRANT inserir TO MICROSSERVICO;

ALTER SESSION SET CURRENT_SCHEMA = SIGLA;

BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE REG_EVT_TST';
EXCEPTION
    WHEN OTHERS THEN
        IF SQLCODE != -942 THEN
            RAISE;
        END IF;
END;

CREATE TABLE REG_EVT_TST
(
    ID      NUMBER GENERATED BY DEFAULT AS IDENTITY,
    ID_RQSC VARCHAR2(255),
    NM_MTD  VARCHAR2(255),
    PRM     VARCHAR2(255),
    RPST    VARCHAR2(255),
    EXCO    VARCHAR2(255),
    PRIMARY KEY (ID)
)


