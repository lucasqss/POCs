-- USUARIOS --

-- Versao do oracle para drop if exists para users
BEGIN
    EXECUTE IMMEDIATE 'DROP USER SIGLA CASCADE';
    EXECUTE IMMEDIATE 'DROP USER MICROSSERVICO CASCADE';
            EXCEPTION
            WHEN OTHERS THEN
    IF SQLCODE != -1918 THEN
            RAISE;
END IF;
END;

CREATE USER SIGLA IDENTIFIED BY cenha;

CREATE USER MICROSSERVICO IDENTIFIED BY cenha;


-- ROLES --

-- Versao do oracle para drop if exists para roles
BEGIN
    EXECUTE IMMEDIATE 'DROP ROLE consultar';
    EXECUTE IMMEDIATE 'DROP ROLE atualizar';
    EXECUTE IMMEDIATE 'DROP ROLE deletar';
    EXECUTE IMMEDIATE 'DROP ROLE inserir';
            EXCEPTION
            WHEN OTHERS THEN
    IF SQLCODE != -1918 THEN
            RAISE;
END IF;
END;


CREATE ROLE consultar;
CREATE ROLE atualizar;
CREATE ROLE deletar;
CREATE ROLE inserir;

BEGIN
            FOR rec IN (SELECT table_name FROM all_tables WHERE owner = 'SIGLA')
        LOOP
    EXECUTE IMMEDIATE 'GRANT SELECT ON SIGLA.' || rec.table_name || ' TO consultar';
    EXECUTE IMMEDIATE 'GRANT INSERT ON SIGLA.' || rec.table_name || ' TO inserir';
    EXECUTE IMMEDIATE 'GRANT UPDATE ON SIGLA.' || rec.table_name || ' TO atualizar';
    EXECUTE IMMEDIATE 'GRANT DELETE ON SIGLA.' || rec.table_name || ' TO deletar';
END LOOP;
END;

-- GRANTS --
GRANT consultar TO MICROSSERVICO;
GRANT atualizar TO MICROSSERVICO;
GRANT deletar TO MICROSSERVICO;
GRANT inserir TO MICROSSERVICO;


-- TABELAS --

-- Versao do oracle para drop if exists para tabelas
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE REG_EVT_TST';
            EXCEPTION
            WHEN OTHERS THEN
    IF SQLCODE != -942 THEN
            RAISE;
END IF;
END;

CREATE TABLE REG_EVT_TST
(
    ID      NUMBER GENERATED BY DEFAULT AS IDENTITY,
    ID_RQSC VARCHAR2(255),
    NM_MTD  VARCHAR2(255),
    PRM     VARCHAR2(255),
    RPST    VARCHAR2(255),
    EXCO    VARCHAR2(255),
    PRIMARY KEY (ID)
)


